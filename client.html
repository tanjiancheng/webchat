<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>聊天室</title>
		<meta name="description" content="">
		<meta name="keywords" content="">
		<link href="" rel="stylesheet">

		<script type="text/javascript" src="jquery.js"></script>

		<script type="text/javascript">
			var timestamp = 0; 
			var url = 'server.php'; 
			var error = false;

			function connect(){ 
				$.ajax({ 
					data : {'timestamp' : timestamp}, 
					url : url, 
					type : 'get', 
					timeout : 0, 
					success : function(response){ 
					var data = eval('('+response+')'); 
					error = false; 
						timestamp = data.timestamp; 
						$("#content").append('<div>' + data.msg + '</div>'); 
					}, 
					error : function(){ 
						error = true; 
						setTimeout(function(){ connect();}, 5000); 
					}, 
					complete : function(){ 
					if (error) 
						 // if a connection problem occurs, try to reconnect each 5 seconds 
						 setTimeout(function(){connect();}, 5000); 
					else 
						connect(); 
					} 
				}) 
			}
			function send(msg){
				$.ajax({ 
					data : {'msg' : msg}, 
					type : 'get', 
					url : url 
				}) 
			} 

			$(document).ready(function(){ 
				connect(); 
			}) 
		</script> 

	</head>

	<body>   
		<div id="content"></div> 
		<p> 
			<form action="" method="get" onsubmit="send($('#word').val());$('#word').val('');return false;"> 
				<input type="text" name="word" id="word" value="" /> 
				<input type="submit" name="submit" value="Send" /> 
			</form>
		</p>
	</body>
	
</html>