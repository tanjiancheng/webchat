<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>聊天室</title>
		<meta name="description" content="">
		<meta name="keywords" content="">

		<link href="css/style.css" rel="stylesheet">
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/common.js"></script>

		<script type="text/javascript">
			var timestamp = 0; 
			var url = 'server.php'; 
			var error = false;

			function connect(){ 
				$.ajax({ 
					data : {'timestamp' : timestamp}, 
					url : url, 
					type : 'get', 
					timeout : 0, 
					success : function(response){ 
						var data = eval('('+response+')'); 
						error = false; 
						timestamp = data.timestamp;
						var content = '';
						var	other_templete = $("#other-content-templete").html();	//单个服内容模板
						var other = [];
						other['otherName'] =  '游客';
						other['otherContent'] =  data.msg;
						other['otherTime'] =  data.currentTime;
						content = format(other_templete, other);	
						$("#chat-content").append(content); 
					}, 
					error : function(){ 
						error = true; 
						setTimeout(function(){ connect();}, 5000); 
					}, 
					complete : function(){ 
					if (error) 
						 // if a connection problem occurs, try to reconnect each 5 seconds 
						 setTimeout(function(){connect();}, 5000); 
					else 
						connect(); 
					} 
				}) 
			}
			function send(msg){
				$.ajax({ 
					data : {'msg' : msg}, 
					type : 'get', 
					url : url 
				}) 
			}

			document.onkeydown = function(e){
	            var ev = document.all ? window.event : e;
	            if(ev.keyCode==13) {
	                $("#submit").trigger('click');
	            }
	        } 

			$(document).ready(function(){ 
				connect();
			}) 
		</script> 

	</head>

	<body class="body-blue">
		<div id="container">
			<div id="header" style="position:relative;">
				<h1 style="position:absolute;bottom:0px;padding:0 10px">小成成聊天室v1.00</h1>
			</div> 
			<div id="chat-content">
				<!-- <div class="other">
					<span class="other-pic">
						<img src="images/other.gif" alt="">
						<em>游客</em>
					</span>
					<table class="chat-table">
						<tr>
							<td>
								<div class="other-chat-conent">
									465465465465645
								</div>
							</td>
						</tr>
						<tr>
							<td>
								2014-04-26 17:24:43
							</td>
						</tr>
					</table>
				</div> -->
			</div>
			<div id="inputP">
				<form action="" method="get" onsubmit="send($('#word').val());$('#word').val('');return false;"> 
					<div id="inputPL" class="fixPng"></div>
					<div id="inputPM" style="width: 766px;">
						<textarea rows="" cols="" id="word" name="word"></textarea>
					</div>
					<div id="inputPR" class="fixPng">
						<input type="submit" name="submit" id="submit" value="">
					</div>
				</form>
			</div>
		</div>


		<!-- 其他人聊天信息模板 -->
		<div id="other-content-templete" style="display:none">
			<div class="other">
				<span class="other-pic">
					<img src="images/other.gif" alt="">
					<em>%otherName</em>
				</span>
				<table class="chat-table">
					<tr>
						<td>
							<div class="other-chat-conent">
								%otherContent
							</div>
						</td>
					</tr>
					<tr>
						<td>
							%otherTime
						</td>
					</tr>
				</table>
			</div> 
		</div>
		<!-- end -->
		   
		
	</body>
	
</html>